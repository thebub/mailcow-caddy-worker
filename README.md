# Caddy Certificate Sync Container

This repository provides a small Docker container that **copies ACME certificates generated by Caddy** from a Docker volume into a destination directory and **restarts dependent containers (e.g. Mailcow)** when certificates change.

It is designed to be run as a **sidecar container** alongside a Caddy reverse proxy.

---

## âœ¨ Features

- âœ… Works with **Caddy Docker containers**
- âœ… Fully configurable via **environment variables**
- âœ… **Idempotent** (only copies when certs actually change)
- âœ… Optional **post-copy hooks** to restart containers
- âœ… Matches the logic used in the official **Mailcow Caddy template** (https://docs.mailcow.email/post_installation/reverse-proxy/r_p-caddy2/)
- âœ… Lightweight (Alpine-based)

---

## ðŸ§© Use Case

This container is useful when:

- Caddy runs in its **own container**
- ACME certificates are stored in a **Docker volume**
- Another service (e.g. Mailcow, Postfix, Dovecot, nginx) requires
  certificates in a **static filesystem location**
- You want automatic updates when certificates renew

---

## ðŸ”§ Configuration

All behavior is controlled via environment variables.

### Required variables

| Variable | Description |
|--------|------------|
| `DOMAIN` | Domain name used by Caddy |
| `CADDY_ACME_BASE` | Mount point of Caddy ACME volume |
| `CADDY_ACME_CA_DIR` | ACME CA directory name |
| `DEST_CERT_DIR` | Destination directory for certs |
| `RESTART_CONTAINERS` | Space-separated container names |

### Optional variables

| Variable | Default | Description |
|--------|--------|------------|
| `DEST_CERT_NAME` | `cert.pem` | Destination cert filename |
| `DEST_KEY_NAME` | `key.pem` | Destination key filename |
| `CHECK_INTERVAL` | `3600` | Seconds between checks |
| `DOCKER_BIN` | `docker` | Docker CLI path |

